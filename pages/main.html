<head>
  <title>Forum</title>
  <link rel="stylesheet" type="text/css" href="/pages/style/styles.css">
</head>

<body>
  <header>
    <h1>Forum</h1>
    <nav>
      <a href="/pages/login.html" class="login-btn">Login</a>
      <a href="/pages/add-post.html" class="add-post-btn">➕</a>
    </nav>
  </header>

  <div class="container">
    <div class="filter">
      <label for="category-filter">Filter by Category:</label>
      <select id="category-filter">
        <option value="all">All Categories</option>
        <option value="tech">Tech</option>
        <option value="sports">Sports</option>
        <option value="music">Music</option>
      </select>
    </div>
    <div id="posts">
      <!-- Posts will be dynamically generated here -->
    </div>
  </div>
</body>

<script>
  getPosts();

  async function getPosts() {
    fetch("/get-posts")
      .then((response) => response.json())
      .then((posts) => {
        console.log(posts);
        posts.forEach(postData => {
          var postLink = document.createElement("a");
          var post = document.createElement("div");
          var postHeader = document.createElement("div");
          var postContent = document.createElement("p");
          var postActions = document.createElement("div");
          var postCategory = document.createElement("span");
          var like = document.createElement("span");
          var comment = document.createElement("span");

          postLink.href = `/pages/post.html?id=${postData.id}`;
          postLink.classList.add("post-link");

          postContent.textContent = `${postData.message}`;

          postData.categories.forEach(cat => {
            postCategory.textContent += `${cat.name} `;
          });

          like.textContent = `❤️ ${postData.like_count}`;
          comment.textContent = `💬 Comments`;

          post.classList.add("post");
          postHeader.classList.add("post-header");
          postActions.classList.add("post-actions");
          postCategory.classList.add("category");
          like.classList.add("like");
          comment.classList.add("comment");

          postHeader.appendChild(postCategory);
          postHeader.append(` ${postData.title}`);

          postActions.appendChild(like);
          postActions.appendChild(comment);

          post.appendChild(postHeader);
          post.appendChild(postContent);
          post.appendChild(postActions);

          postLink.appendChild(post);
          document.getElementById("posts").appendChild(postLink);
        });
      })
      .catch((error) => {
        console.log(error);
        document.getElementById("posts").append("Error getting posts, please refresh!");
      });
  }
</script>